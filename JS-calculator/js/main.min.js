"use strict";jQuery(function(t){function e(e,n,a){var r=[];return t.each(e,function(o){var i=[],c=e[o];if(o=n[o],c.b&&i.push("inset"),void 0!==o.left&&i.push(parseFloat(c.left+a*(o.left-c.left))+"px "+parseFloat(c.top+a*(o.top-c.top))+"px"),void 0!==o.blur&&i.push(parseFloat(c.blur+a*(o.blur-c.blur))+"px"),void 0!==o.a&&i.push(parseFloat(c.a+a*(o.a-c.a))+"px"),void 0!==o.color){var s="rgb"+(t.support.rgba?"a":"")+"("+parseInt(c.color[0]+a*(o.color[0]-c.color[0]),10)+","+parseInt(c.color[1]+a*(o.color[1]-c.color[1]),10)+","+parseInt(c.color[2]+a*(o.color[2]-c.color[2]),10);t.support.rgba&&(s+=","+parseFloat(c.color[3]+a*(o.color[3]-c.color[3]))),i.push(s+")")}r.push(i.join(" "))}),r.join(", ")}function n(e){function n(){var t=/^\s+/.exec(e.substring(o));null!==t&&0<t.length&&(o+=t[0].length)}function a(e){if(t.isPlainObject(e)){var n,a,r=0,o=[];for(t.isArray(e.color)&&(a=e.color,r=a.length),n=0;4>n;n++)n<r?o.push(a[n]):3===n?o.push(1):o.push(0)}return t.extend({left:0,top:0,blur:0,spread:0},e)}for(var r=[],o=0,i=e.length,c=a();o<i;)if(function(){var t=/^inset\b/.exec(e.substring(o));return null!==t&&0<t.length&&(c.b=!0,o+=t[0].length,!0)}())n();else if(function(){var t=/^(-?[0-9\.]+)(?:px)?\s+(-?[0-9\.]+)(?:px)?(?:\s+(-?[0-9\.]+)(?:px)?)?(?:\s+(-?[0-9\.]+)(?:px)?)?/.exec(e.substring(o));return null!==t&&0<t.length&&(c.left=parseInt(t[1],10),c.top=parseInt(t[2],10),c.blur=t[3]?parseInt(t[3],10):0,c.a=t[4]?parseInt(t[4],10):0,o+=t[0].length,!0)}())n();else if(function(){var t=/^#([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})/.exec(e.substring(o));return null!==t&&0<t.length?(c.color=[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16),1],o+=t[0].length,!0):null!==(t=/^#([0-9a-fA-F])([0-9a-fA-F])([0-9a-fA-F])/.exec(e.substring(o)))&&0<t.length?(c.color=[17*parseInt(t[1],16),17*parseInt(t[2],16),17*parseInt(t[3],16),1],o+=t[0].length,!0):null!==(t=/^rgb\(\s*([0-9\.]+)\s*,\s*([0-9\.]+)\s*,\s*([0-9\.]+)\s*\)/.exec(e.substring(o)))&&0<t.length?(c.color=[parseInt(t[1],10),parseInt(t[2],10),parseInt(t[3],10),1],o+=t[0].length,!0):null!==(t=/^rgba\(\s*([0-9\.]+)\s*,\s*([0-9\.]+)\s*,\s*([0-9\.]+)\s*,\s*([0-9\.]+)\s*\)/.exec(e.substring(o)))&&0<t.length&&(c.color=[parseInt(t[1],10),parseInt(t[2],10),parseInt(t[3],10),parseFloat(t[4])],o+=t[0].length,!0)}())n();else{if(!function(){var t=/^\s*,\s*/.exec(e.substring(o));return null!==t&&0<t.length&&(o+=t[0].length,!0)}())break;r.push(a(c)),c={}}return r.push(a(c)),r}t.extend(!0,t,{support:{rgba:function(){var e=t("script:first"),n=e.css("color"),a=!1;if(/^rgba/.test(n))a=!0;else try{a=n!==e.css("color","rgba(0, 0, 0, 0.5)").css("color"),e.css("color",n)}catch(t){}return e.removeAttr("style"),a}()}});var a,r=t("html").prop("style");t.each(["boxShadow","MozBoxShadow","WebkitBoxShadow"],function(t,e){if(void 0!==r[e])return a=e,!1}),a&&(t.Tween.propHooks.boxShadow={get:function(e){return t(e.elem).css(a)},set:function(r){var o,i=r.elem.style,c=n(t(r.elem)[0].style[a]||t(r.elem).css(a)),s=n(r.end),l=Math.max(c.length,s.length);for(o=0;o<l;o++)s[o]=t.extend({},c[o],s[o]),c[o]?"color"in c[o]&&!1!==t.isArray(c[o].color)||(c[o].color=s[o].color||[0,0,0,0]):c[o]=n("0 0 0 0 rgba(0,0,0,0)")[0];r.run=function(t){t=e(c,s,t),i[a]=t}}})});var display=$(".calculator__display"),opertors,priority,result,calculator={init:function(){mousePush.init(),keyboardPush.init(),displayBlock.init()}},displayBlock={init:function(){$(".calculator__display").keypress(function(){return!1})}},mousePush={init:function(){this.key(),this.button(),this.clean(),this.backspace(),this.equal()},key:function(){$(".calculator__key").click(function(){mistake.coverUp()})},button:function(){$(".calculator__button").click(function(){spellingRuntime.char=$(this).attr("value"),console.log(spellingRuntime.char),spellingRuntime.init()})},clean:function(){$(".calculator__clean").click(function(){operations.clean()})},backspace:function(){$(".calculator__backspace").click(function(){operations.backspace()})},equal:function(){$(".calculator__equal").click(function(){operations.equal()})}},keyboardPush={init:function(){this.button(),this.clean(),this.backspace(),this.equal()},button:function(){$(".calculator__display").keydown(function(t){mistake.coverUp(),spellingRuntime.char=t.key,console.log(t.key),spellingRuntime.init()})},clean:function(){$(".calculator__display").keydown(function(t){"c"==t.key&&operations.clean()})},backspace:function(){$(".calculator__display").keydown(function(t){"Backspace"==t.key&&operations.keyboardBackspace()})},equal:function(){$(".calculator__display").keydown(function(t){"Enter"!=t.key&&"="!=t.key||operations.equal()})}},spellingRuntime={init:function(){this.numerals(),this.operator(),this.openingBracket(),this.closingBracket(),this.percent(),this.dot()},char:"",numerals:function(){this.char.match(/\d/g)&&(1==last.percent()?mistake.made("You can't input numbers right after percent sign"):1==last.closingBracket()?mistake.made("You can't input numbers right after closing bracket"):display.val(display.val()+this.char))},operator:function(){var t=/\+|\-|\*|\//g;this.char.match(t)&&(1==last.number()?(display.val(display.val()+this.char),this.dotLock=!1):1==last.operator()?display.val(display.val().slice(0,display.val().length-1)+this.char):1==last.closingBracket()?(display.val(display.val()+this.char),this.dotLock=!1):1==last.percent()?(display.val(display.val()+this.char),this.dotLock=!1):1==last.openingBracket()?"-"==this.char?(display.val(display.val()+this.char),this.dotLock=!1):mistake.made("You can't input operators right after opening bracket"):""==display.val()&&("-"==this.char?(display.val(display.val()+this.char),this.dotLock=!1):mistake.made("You can't input operators when form is empty")))},openingBracket:function(){"("==this.char&&(""==display.val()?(display.val(display.val()+this.char),brackets.countUp()):1==last.operator()?(display.val(display.val()+this.char),brackets.countUp()):1==last.openingBracket()?(display.val(display.val()+this.char),brackets.countUp()):1==last.number()?mistake.made("You can input opening bracket only after operator or another opening bracket"):1==last.percent()&&mistake.made("You can't input opening bracket right after percent sign"))},closingBracket:function(){")"==this.char&&0!=brackets.counter?1==last.number()?(display.val(display.val()+this.char),brackets.countDown()):1==last.percent()?(display.val(display.val()+this.char),brackets.countDown()):1==last.closingBracket()?(display.val(display.val()+this.char),brackets.countDown()):1==last.operator()?mistake.made("You can't input closing bracket right after operator"):1==last.openingBracket()&&mistake.made("You can't input closing bracket right after opening bracket"):")"==this.char&&""==display.val()?mistake.made("You can't input closing bracket when form is empty"):")"==this.char&&0==brackets.counter&&mistake.made("You can't input closing bracket without fitting opening bracket before")},percent:function(){"%"==this.char&&(1==last.number()?display.val(display.val()+this.char):1==last.closingBracket()?display.val(display.val()+this.char):1==last.operator()?display.val(display.val().slice(0,display.val().length-1)+this.char):1==last.openingBracket()?mistake.made("You can't input % right after opening bracket"):""==display.val()&&mistake.made("You can't input % when form is empty"))},dotLock:!1,dot:function(){"."==this.char&&0==this.dotLock&&(console.log(this.dotLock),display.val(display.val()+this.char),this.dotLock=!0,console.log(this.dotLock))}},spelling={init:function(){var t=display.val();""==t?mistake.made("Please type something"):null!=t.match(/\%+\d/g)?mistake.made("You can't input nubmer right after percent operator"):null!=t.match(/\)+\d/g)?mistake.made("You can't input nubmer right after closing bracket"):null==t.match(/^\s*$|\.\d+|\d+(\.\d+)|\d+|\+|\-|\*|\/|\%|\(|\)/g)?mistake.made("You provided unsupported character or operator"):null!=t.match(/^(\+|\*|\/|\%|\))/g)?mistake.made("Equation can't start with this operators [+ * / % )]"):null!=t.match(/(\+|\-|\*|\/|\()+(\+|\-|\*|\/)/g)?mistake.made("Operator can't stay right after operator or opening bracket"):null!=t.match(/\d+\(/g)?mistake.made("opening bracket can't stay right after number"):null!=t.match(/\%+\(/g)?mistake.made("You can't input opening bracket right after percent sign"):null!=t.match(/\(+\)/g)?mistake.made("You can't input closing bracket right after opening bracket"):null!=t.match(/(\+|\-|\*|\/)+\)/g)?mistake.made("You can't input closing bracket right after operator"):null!=t.match(/\(+\%/g)?mistake.made("You can't input % right after opening bracket"):brackets.solve()}},brackets={counter:0,content:"",inner:"",countUp:function(){this.counter++},countDown:function(){this.counter--},reset:function(){this.counter=0},solve:function(){var t,e=display.val().match(/\(/g);if(this.content=display.val(),null==e){this.inner=this.content,convert.init(),operations.init();o=convert.convertedInput[0];0==isNaN(parseFloat(o))||o==1/0?display.val(o):display.val("Error")}else{t=e.length;for(var n,a,r=0;r<t;r++)console.log(this.content),n=this.content.lastIndexOf("("),this.inner=this.content.slice(n),a=this.inner.indexOf(")")+1,this.inner=this.inner.slice(0,a),convert.init(),console.log(convert.convertedInput),operations.init(),convert.convertedInput.shift(),convert.convertedInput.pop(),this.content=this.content.replace(this.inner,convert.convertedInput),console.log(this.content);this.inner=this.content,convert.init(),operations.init(),display.val(convert.convertedInput);var o=convert.convertedInput[0];0==isNaN(parseFloat(o))||o==1/0?display.val(o):display.val("Error")}}},last={char:function(){var t,e;return t=display.val(),e=t.length,t[e-1]},dot:function(){return"."==this.char()},number:function(){var t=this.char(),e=parseFloat(t);return 0==isNaN(e)},operator:function(){var t=this.char();return void 0==t&&(t=""),null!=t.match(/\+|\-|\*|\//g)},openingBracket:function(){return"("==this.char()},closingBracket:function(){return")"==this.char()},percent:function(){return"%"==this.char()}},mistake={container:$(".calculator__error"),message:$(".calculator__error span"),made:function(t){this.message.text(t),this.container.show("fast"),$(".calculator").animate({boxShadow:"0 0 15px #b70404"},"fast")},coverUp:function(){this.container.hide("fast"),$(".calculator").animate({boxShadow:"none"},"fast")}},convert={convertedInput:[],init:function(){var t,e=brackets.inner;this.convertedInput=e.match(/\.\d+|\d+(\.\d+)|\d+|\+|\-|\*|\/|\%|\(|\)/g),t=e.match(/\d+(\.\d+)|\d+|\+|\-|\*|\/|\%|\(|\)/g);for(var n=0;n<this.convertedInput.length;n++)this.convertedInput[n]=parseFloat(this.convertedInput[n]),1==isNaN(this.convertedInput[n])&&(this.convertedInput[n]=t[n])}},operations={init:function(){for(var t=display.val().match(/\+|\-|\*|\/|\%/g),e=0;e<t.length;e++){var n=convert.convertedInput;this.percent(),-1==n.indexOf("%")&&(this.multiplying_dividing(),-1==n.indexOf("*")&&-1==n.indexOf("/")&&this.addition_subtraction())}},findOperatorIndex:function(t){for(var t,e,n,a=convert.convertedInput,r=0;r<a.length;r++)if(1==isNaN(a[r])&&null!=a[r].match(t)){n=a[r],e=r;break}return[n,e]},addition_subtraction:function(){var t=this.findOperatorIndex(/\+|\-/);if(void 0!=t[0]){var e=convert.convertedInput,n=t[0],a=t[1];console.log("index "+a),console.log("last "+last),"+"==n?"-"==e[a+1]?(result=e[a-1]+-e[a+2],e.splice(a-1,4,result),convert.convertedInput=e):void 0==e[a+1]?(result=e[a-1]+e[a-1],e.splice(a-1,2,result),convert.convertedInput=e):(result=e[a-1]+e[a+1],e.splice(a-1,3,result),convert.convertedInput=e):0==a||"("==e[a-1]?(result=-e[a+1],e.splice(a,2,result),convert.convertedInput=e):"-"==e[a+1]?(result=e[a-1]- -e[a+2],e.splice(a-1,4,result),convert.convertedInput=e):void 0==e[a+1]?(result=e[a-1]-e[a-1],e.splice(a-1,2,result),convert.convertedInput=e):(result=e[a-1]-e[a+1],e.splice(a-1,3,result),convert.convertedInput=e),console.log(convert.convertedInput)}},multiplying_dividing:function(){var t=this.findOperatorIndex(/\*|\//);if(void 0!=t[0]){var e=convert.convertedInput,n=t[0],a=t[1];t[2];"*"==n?"-"==e[a+1]?(result=e[a-1]*-e[a+2],e.splice(a-1,4,result),convert.convertedInput=e):void 0==e[a+1]?(result=e[a-1]*e[a-1],e.splice(a-1,2,result),convert.convertedInput=e):(result=e[a-1]*e[a+1],e.splice(a-1,3,result),convert.convertedInput=e):"-"==e[a+1]?(result=e[a-1]/-e[a+2],e.splice(a-1,4,result),convert.convertedInput=e):void 0==e[a+1]?(result=e[a-1]/e[a-1],e.splice(a-1,2,result),convert.convertedInput=e):(result=e[a-1]/e[a+1],e.splice(a-1,3,result),convert.convertedInput=e),console.log(convert.convertedInput)}},percent:function(){var t=this.findOperatorIndex(/%/);if(void 0!=t[0]){var e=convert.convertedInput,n=(t[0],t[1]);"*"==e[n-2]||"/"==e[n-2]?result=e[n-1]/100:"+"!=e[n-2]&&"-"!=e[n-2]||(result=e[n-3]/100*e[n-1]),e.splice(n-1,2,result),convert.convertedInput=e,console.log(convert.convertedInput)}},clean:function(){spellingRuntime.dotLock=!1,brackets.reset(),display.val("")},backspace:function(){1==last.closingBracket()?brackets.countUp():1==last.openingBracket()&&brackets.countDown(),1==last.dot()&&(spellingRuntime.dotLock=!1),display.val(display.val().substring(0,display.val().length-1))},keyboardBackspace:function(){1==last.closingBracket()?brackets.countUp():1==last.openingBracket()&&brackets.countDown(),1==last.dot()&&(spellingRuntime.dotLock=!1)},equal:function(){0==brackets.counter?(spellingRuntime.dotLock=!1,spelling.init()):mistake.made("Please close brackets")}},result={display:function(){}};$("documnet").ready(calculator.init());